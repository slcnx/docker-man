//
// named.conf - DNS Slave Server with View support
//

// 定义访问控制列表（ACL）- 与主服务器相同
acl test_net {
    10.0.0.0/24;        // 测试网段
};

acl prod_net {
    192.168.1.0/24;     // 生产网段
};

acl other_net {
    any;                // 其他所有客户端
};

include "/etc/rndc.key";

options {
    //listen-on port 53 { 127.0.0.1; };
    //listen-on-v6 port 53 { ::1; };
    directory     "/var/named";
    dump-file     "/var/named/data/cache_dump.db";
    statistics-file "/var/named/data/named_stats.txt";
    memstatistics-file "/var/named/data/named_mem_stats.txt";
    secroots-file    "/var/named/data/named.secroots";
    recursing-file    "/var/named/data/named.recursing";

    recursion yes;
    dnssec-validation no;

    pid-file "/run/named/named.pid";
};

logging {
    channel default_debug {
        file "data/named.run";
        severity dynamic;
    };
    channel query_log {
        file "/var/log/named/query.log" versions 3 size 10m;
        severity info;
        print-category yes;
        print-severity yes;
        print-time yes;
    };
    category queries {
        query_log;
    };
};

// ========== 测试视图（从服务器）==========
view test_view {
    match-clients { test_net; };
    recursion yes;

    include "/etc/named.rfc1912.zones";
    include "/etc/named.conf.test-zones-slave";
};

// ========== 生产视图（从服务器）==========
view prod_view {
    match-clients { prod_net; };
    recursion yes;

    include "/etc/named.rfc1912.zones";
    include "/etc/named.conf.prod-zones-slave";
};

// ========== 其他视图（从服务器）==========
view other_view {
    match-clients { other_net; };
    recursion yes;

    include "/etc/named.rfc1912.zones";
};

controls {
    inet * port 953 allow { any; } keys { "rndc-key"; };
};
