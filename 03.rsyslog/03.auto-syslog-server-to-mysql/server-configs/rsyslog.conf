# rsyslog configuration for log-server
# 接收远程日志并写入 MySQL

#### GLOBAL DIRECTIVES ####
global(workDirectory="/var/lib/rsyslog")

#### MODULES ####

# 输出模块
module(load="builtin:omfile" Template="RSYSLOG_TraditionalFileFormat")

# MySQL 输出模块
module(load="ommysql")

# TCP 输入模块（接收远程日志）
module(load="imtcp")
input(type="imtcp" port="514")

# UDP 输入模块（接收远程日志）
module(load="imudp")
input(type="imudp" port="514")

# 本地日志支持
module(load="imuxsock" SysSock.Use="off")
module(load="imjournal"
       UsePid="system"
       FileCreateMode="0644"
       StateFile="imjournal.state")

#### RULES ####

# 所有日志写入 MySQL（包括远程日志）
*.*  :ommysql:mysql-server,Syslog,rsyslog,rsyslogpass

# 本地日志也保存到文件
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                  /var/log/secure
mail.*                                      -/var/log/maillog
cron.*                                      /var/log/cron
*.emerg                                     :omusrmsg:*
