# Rsync å‘½ä»¤é€‰é¡¹å®Œå…¨æŒ‡å—

**ç‰ˆæœ¬**: rsync 3.2.5
**åè®®ç‰ˆæœ¬**: 31
**æ–‡æ¡£æ›´æ–°**: 2025-10-09

---

## ğŸ“‹ ç›®å½•

0. [**Rsync åè®®ä¸å‘½ä»¤æ ¼å¼**](#0-rsync-åè®®ä¸å‘½ä»¤æ ¼å¼) â­
1. [åŸºç¡€ä¼ è¾“é€‰é¡¹](#1-åŸºç¡€ä¼ è¾“é€‰é¡¹)
2. [æ–‡ä»¶å±æ€§ä¿ç•™](#2-æ–‡ä»¶å±æ€§ä¿ç•™)
3. [æ–‡ä»¶è¿‡æ»¤ä¸æ’é™¤](#3-æ–‡ä»¶è¿‡æ»¤ä¸æ’é™¤)
4. [åŒæ­¥ç­–ç•¥](#4-åŒæ­¥ç­–ç•¥)
5. [æ€§èƒ½ä¼˜åŒ–](#5-æ€§èƒ½ä¼˜åŒ–)
6. [ç½‘ç»œä¸è¿æ¥](#6-ç½‘ç»œä¸è¿æ¥)
7. [å®‰å…¨ä¸æƒé™](#7-å®‰å…¨ä¸æƒé™)
8. [æ—¥å¿—ä¸ç›‘æ§](#8-æ—¥å¿—ä¸ç›‘æ§)
9. [é«˜çº§åŠŸèƒ½](#9-é«˜çº§åŠŸèƒ½)
10. [å¸¸ç”¨åœºæ™¯ç»„åˆ](#10-å¸¸ç”¨åœºæ™¯ç»„åˆ)

---

## 0. Rsync åè®®ä¸å‘½ä»¤æ ¼å¼

### 0.1 ä¸‰ç§å·¥ä½œæ¨¡å¼æ¦‚è§ˆ

Rsync æ”¯æŒä¸‰ç§åŸºæœ¬å·¥ä½œæ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼çš„**å‘½ä»¤æ ¼å¼**å’Œ**ä½¿ç”¨åœºæ™¯**éƒ½ä¸åŒã€‚

| æ¨¡å¼ | å‘½ä»¤æ ¼å¼ | ä¼ è¾“æ–¹å¼ | ç«¯å£ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|------|---------|
| **æœ¬åœ°æ¨¡å¼** | `rsync [é€‰é¡¹] SRC DEST` | æœ¬åœ°æ–‡ä»¶å¤åˆ¶ | - | åŒä¸€ä¸»æœºå†…å¤åˆ¶ |
| **SSH æ¨¡å¼** | `rsync [é€‰é¡¹] SRC user@host:/dest` | SSH åŠ å¯†ä¼ è¾“ | 22 | äº’è”ç½‘ã€é«˜å®‰å…¨éœ€æ±‚ |
| **Daemon æ¨¡å¼** | `rsync [é€‰é¡¹] SRC rsync://user@host/module` | rsync åè®® | 873 | å†…ç½‘ã€é«˜æ€§èƒ½éœ€æ±‚ |

---

### 0.2 æœ¬åœ°æ¨¡å¼ï¼ˆLocalï¼‰

**ç”¨é€”**ï¼šåœ¨åŒä¸€å°ä¸»æœºå†…å¤åˆ¶æ–‡ä»¶ï¼Œç±»ä¼¼ `cp` å‘½ä»¤ä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚

**å‘½ä»¤æ ¼å¼**ï¼š
```bash
rsync [é€‰é¡¹] /source/ /destination/
```

**ç¤ºä¾‹**ï¼š
```bash
# æœ¬åœ°å®Œæ•´å¤‡ä»½
rsync -av /data/source/ /backup/

# æœ¬åœ°é•œåƒåŒæ­¥
rsync -av --delete /web/ /backup/web/

# è·¨æŒ‚è½½ç‚¹æœ¬åœ°å¤åˆ¶
rsync -av /home/ /mnt/backup/home/
```

**ç‰¹ç‚¹**ï¼š
- âœ… ä¸æ¶‰åŠç½‘ç»œä¼ è¾“
- âœ… æ”¯æŒå¢é‡å¤åˆ¶ï¼ˆæ¯” cp æ›´é«˜æ•ˆï¼‰
- âœ… å¯ä»¥ä½¿ç”¨æ‰€æœ‰ rsync åŠŸèƒ½ï¼ˆæ’é™¤ã€åˆ é™¤ç­‰ï¼‰
- âš ï¸ é»˜è®¤ä½¿ç”¨å¢é‡ç®—æ³•ï¼Œæœ¬åœ°å¯ç”¨ `-W` åŠ é€Ÿ

---

### 0.3 SSH æ¨¡å¼ï¼ˆRemote Shellï¼‰

**ç”¨é€”**ï¼šé€šè¿‡ SSH åè®®è¿›è¡Œè¿œç¨‹ä¼ è¾“ï¼Œæ•°æ®å…¨ç¨‹åŠ å¯†ã€‚

#### 0.3.1 å‘½ä»¤æ ¼å¼

**æ ‡å‡†æ ¼å¼**ï¼š
```bash
# æ¨é€åˆ°è¿œç¨‹
rsync [é€‰é¡¹] /local/source/ user@remote-host:/remote/dest/

# ä»è¿œç¨‹æ‹‰å–
rsync [é€‰é¡¹] user@remote-host:/remote/source/ /local/dest/

# è¿œç¨‹åˆ°è¿œç¨‹ï¼ˆä¸æ¨èï¼‰
rsync [é€‰é¡¹] user@host1:/path1/ user@host2:/path2/
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ **å•å†’å· `:`** åˆ†éš”ä¸»æœºå’Œè·¯å¾„
- è·¯å¾„æ˜¯**ç»å¯¹è·¯å¾„**ï¼ˆä»æ ¹ç›®å½•å¼€å§‹ï¼‰æˆ–**ç›¸å¯¹è·¯å¾„**ï¼ˆç›¸å¯¹äºç”¨æˆ·å®¶ç›®å½•ï¼‰

#### 0.3.2 è¯¦ç»†ç¤ºä¾‹

```bash
# ç¤ºä¾‹ 1ï¼šæ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ˆç»å¯¹è·¯å¾„ï¼‰
rsync -avz /data/source/ root@192.168.1.100:/backup/dest/
#                        ^^^^              ^^^^^^^^^^^^
#                        ç”¨æˆ·@ä¸»æœº         ç»å¯¹è·¯å¾„

# ç¤ºä¾‹ 2ï¼šæ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ˆç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äº root å®¶ç›®å½•ï¼‰
rsync -avz /data/source/ root@192.168.1.100:backup/
#                                           ^^^^^^^
#                                           ç›¸å¯¹è·¯å¾„ = /root/backup/

# ç¤ºä¾‹ 3ï¼šä»è¿œç¨‹æ‹‰å–
rsync -avz user@server:/var/www/ /local/www/

# ç¤ºä¾‹ 4ï¼šæŒ‡å®š SSH ç«¯å£
rsync -avz -e "ssh -p 2222" /source/ user@host:/dest/

# ç¤ºä¾‹ 5ï¼šæŒ‡å®š SSH å¯†é’¥
rsync -avz -e "ssh -i /root/.ssh/id_rsa" /source/ user@host:/dest/

# ç¤ºä¾‹ 6ï¼šSSH è·³è¿‡ä¸»æœºéªŒè¯
rsync -avz -e "ssh -o StrictHostKeyChecking=no" /source/ user@host:/dest/
```

#### 0.3.3 å·¥ä½œåŸç†

```
æœ¬åœ°                                     è¿œç¨‹
 â†“                                        â†“
rsync å‘½ä»¤                             SSH æœåŠ¡å™¨ (sshd)
 â†“                                        â†“
å»ºç«‹ SSH è¿æ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ éªŒè¯ SSH å¯†é’¥
 â†“                                        â†“
åœ¨ SSH é€šé“å†…å‘é€ rsync åè®®              å¯åŠ¨ rsync å­è¿›ç¨‹
 â†“                                        â†“
åŠ å¯†ä¼ è¾“æ–‡ä»¶æ•°æ® â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ¥æ”¶å¹¶å†™å…¥æ–‡ä»¶
```

#### 0.3.4 ç‰¹ç‚¹æ€»ç»“

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **è®¤è¯æ–¹å¼** | SSH å¯†é’¥æˆ– SSH å¯†ç  |
| **åŠ å¯†** | âœ… å…¨ç¨‹åŠ å¯†ï¼ˆSSHï¼‰ |
| **ç«¯å£** | 22ï¼ˆSSH é»˜è®¤ç«¯å£ï¼‰ |
| **æ€§èƒ½** | ä¸­ç­‰ï¼ˆæœ‰åŠ å¯†å¼€é”€ï¼‰ |
| **å®‰å…¨æ€§** | é«˜ |
| **é…ç½®** | éœ€è¦é…ç½® SSH å¯†é’¥æˆ–å¯†ç  |
| **é€‚ç”¨åœºæ™¯** | äº’è”ç½‘ã€è·¨ç½‘æ®µã€é«˜å®‰å…¨éœ€æ±‚ |

---

### 0.4 Daemon æ¨¡å¼ï¼ˆRsync Daemonï¼‰

**ç”¨é€”**ï¼šé€šè¿‡ rsync daemon æœåŠ¡è¿›è¡Œä¼ è¾“ï¼Œé€‚åˆå†…ç½‘é«˜æ€§èƒ½åœºæ™¯ã€‚

#### 0.4.1 ä¸¤ç§å‘½ä»¤æ ¼å¼

Daemon æ¨¡å¼æœ‰**ä¸¤ç§ç­‰ä»·çš„å†™æ³•**ï¼š

##### æ ¼å¼ 1ï¼šURL é£æ ¼ï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨ rsync:// åè®®å¤´ï¼ˆæ¨èï¼‰
rsync [é€‰é¡¹] /local/ rsync://user@host/module/path
rsync [é€‰é¡¹] /local/ rsync://user@host:port/module/path  # æŒ‡å®šç«¯å£
```

**ç¤ºä¾‹**ï¼š
```bash
# æ¨é€åˆ° rsync daemon
rsync -avz /data/source/ rsync://rsyncuser@10.0.5.21/backup/

# ä» rsync daemon æ‹‰å–
rsync -avz rsync://rsyncuser@10.0.5.21/backup/ /local/dest/

# æŒ‡å®šéæ ‡å‡†ç«¯å£
rsync -avz /source/ rsync://user@host:8873/module/

# åˆ—å‡ºæœåŠ¡å™¨ä¸Šçš„æ¨¡å—
rsync rsync://10.0.5.21/

# åˆ—å‡ºæ¨¡å—å†…çš„æ–‡ä»¶
rsync rsync://rsyncuser@10.0.5.21/backup/
```

##### æ ¼å¼ 2ï¼šä¼ ç»Ÿé£æ ¼ï¼ˆåŒå†’å·ï¼‰

```bash
# ä½¿ç”¨åŒå†’å· :: åˆ†éš”ä¸»æœºå’Œæ¨¡å—ï¼ˆä¼ ç»Ÿå†™æ³•ï¼‰
rsync [é€‰é¡¹] /local/ user@host::module/path
```

**ç¤ºä¾‹**ï¼š
```bash
# æ¨é€ï¼ˆåŒå†’å·å†™æ³•ï¼‰
rsync -avz /data/source/ rsyncuser@10.0.5.21::backup/

# æ‹‰å–ï¼ˆåŒå†’å·å†™æ³•ï¼‰
rsync -avz rsyncuser@10.0.5.21::backup/ /local/dest/

# åˆ—å‡ºæ¨¡å—ï¼ˆåŒå†’å·å†™æ³•ï¼‰
rsync user@host::
```

#### 0.4.2 å…³é”®ç‚¹å¯¹æ¯”

| ç‰¹æ€§ | URL é£æ ¼ | åŒå†’å·é£æ ¼ |
|------|---------|-----------|
| **æ ¼å¼** | `rsync://user@host/module/` | `user@host::module/` |
| **å¯è¯»æ€§** | âœ… æ›´æ¸…æ™° | ä¸€èˆ¬ |
| **æŒ‡å®šç«¯å£** | `rsync://host:port/module/` | éœ€è¦ `--port` é€‰é¡¹ |
| **æ ‡å‡†åŒ–** | âœ… ç¬¦åˆ URI æ ‡å‡† | ä¼ ç»Ÿæ ¼å¼ |
| **æ¨èç¨‹åº¦** | â­â­â­ æ¨è | å…¼å®¹æ—§ç‰ˆ |

**âš ï¸ é‡è¦åŒºåˆ«**ï¼š
- SSH æ¨¡å¼ï¼š`user@host:/path`ï¼ˆ**å•å†’å·** + æ–‡ä»¶è·¯å¾„ï¼‰
- Daemon æ¨¡å¼ï¼š`user@host::module`ï¼ˆ**åŒå†’å·** + æ¨¡å—åï¼‰

#### 0.4.3 æ¨¡å—ï¼ˆModuleï¼‰æ¦‚å¿µ

**ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ**

- Daemon æ¨¡å¼ä½¿ç”¨**æ¨¡å—**è€Œéç›´æ¥çš„æ–‡ä»¶è·¯å¾„
- æ¨¡å—åœ¨æœåŠ¡ç«¯çš„ `rsyncd.conf` ä¸­å®šä¹‰
- æ¯ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªå®é™…çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
- æ¯ä¸ªæ¨¡å—å¯ä»¥æœ‰ç‹¬ç«‹çš„æƒé™å’Œè®¤è¯é…ç½®

**æœåŠ¡ç«¯é…ç½®ç¤ºä¾‹** (`/etc/rsync/rsyncd.conf`):
```ini
[backup]                          # æ¨¡å—å
    path = /data/backup           # å®é™…è·¯å¾„
    read only = no
    auth users = rsyncuser
    secrets file = /etc/rsync/rsyncd.secrets

[public]                          # å¦ä¸€ä¸ªæ¨¡å—
    path = /data/public
    read only = yes
    list = yes
```

**å®¢æˆ·ç«¯è®¿é—®**ï¼š
```bash
# è®¿é—® backup æ¨¡å—ï¼ˆå¯¹åº” /data/backupï¼‰
rsync -avz /source/ rsync://rsyncuser@server/backup/

# è®¿é—® public æ¨¡å—ï¼ˆå¯¹åº” /data/publicï¼‰
rsync -avz rsync://server/public/ /local/public/
```

#### 0.4.4 è®¤è¯æ–¹å¼

**æ–¹æ³• 1ï¼šäº¤äº’å¼è¾“å…¥å¯†ç **
```bash
rsync -avz /source/ rsync://rsyncuser@10.0.5.21/backup/
# æç¤ºï¼šPassword:
# è¾“å…¥ï¼šrsyncpass123
```

**æ–¹æ³• 2ï¼šä½¿ç”¨å¯†ç æ–‡ä»¶ï¼ˆè‡ªåŠ¨åŒ–ï¼‰**
```bash
# åˆ›å»ºå¯†ç æ–‡ä»¶ï¼ˆä»…åŒ…å«å¯†ç ï¼‰
echo "rsyncpass123" > /etc/rsync/rsync.pass
chmod 600 /etc/rsync/rsync.pass

# ä½¿ç”¨å¯†ç æ–‡ä»¶
rsync -avz --password-file=/etc/rsync/rsync.pass \
    /source/ rsync://rsyncuser@10.0.5.21/backup/
```

**âš ï¸ å¯†ç æ–‡ä»¶æƒé™**ï¼š
- å¿…é¡»æ˜¯ **600**ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
- å¦åˆ™ rsync ä¼šæ‹’ç»ä½¿ç”¨å¹¶æŠ¥é”™

#### 0.4.5 å®Œæ•´ç¤ºä¾‹

```bash
# ç¤ºä¾‹ 1ï¼šæ¨é€æ•°æ®åˆ° daemonï¼ˆä½¿ç”¨å¯†ç æ–‡ä»¶ï¼‰
rsync -avz --password-file=/etc/rsync/rsync.pass \
    /data/source/ rsync://rsyncuser@10.0.5.21/backup/

# ç¤ºä¾‹ 2ï¼šä» daemon æ‹‰å–æ•°æ®
rsync -avz --password-file=/etc/rsync/rsync.pass \
    rsync://rsyncuser@10.0.5.21/backup/ /data/restore/

# ç¤ºä¾‹ 3ï¼šé•œåƒåŒæ­¥ï¼ˆåˆ é™¤å¤šä½™æ–‡ä»¶ï¼‰
rsync -avz --delete --password-file=/etc/rsync/rsync.pass \
    /source/ rsync://rsyncuser@10.0.5.21/backup/

# ç¤ºä¾‹ 4ï¼šåˆ—å‡ºæœåŠ¡å™¨æ‰€æœ‰æ¨¡å—
rsync rsync://10.0.5.21/

# è¾“å‡ºç¤ºä¾‹ï¼š
# backup         Backup Module with Authentication
# public         Public Read-Only Module

# ç¤ºä¾‹ 5ï¼šåˆ—å‡ºæ¨¡å—å†…çš„æ–‡ä»¶
rsync rsync://rsyncuser@10.0.5.21/backup/

# ç¤ºä¾‹ 6ï¼šæŒ‡å®šéæ ‡å‡†ç«¯å£ï¼ˆURL æ ¼å¼ï¼‰
rsync -avz /source/ rsync://user@host:8873/module/

# ç¤ºä¾‹ 7ï¼šæŒ‡å®šéæ ‡å‡†ç«¯å£ï¼ˆåŒå†’å·æ ¼å¼ï¼‰
rsync -avz --port=8873 /source/ user@host::module/
```

#### 0.4.6 å·¥ä½œåŸç†

```
å®¢æˆ·ç«¯                                æœåŠ¡ç«¯
  â†“                                    â†“
rsync å‘½ä»¤                         rsync daemon (rsyncd)
  â†“                                    â†“
è¿æ¥ç«¯å£ 873 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç›‘å¬ç«¯å£ 873
  â†“                                    â†“
å‘é€æ¨¡å—åå’Œè®¤è¯ä¿¡æ¯                  è¯»å– rsyncd.conf
  â†“                                    â†“
å‘é€ç”¨æˆ·å+å¯†ç  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ éªŒè¯ rsyncd.secrets
  â†“                                    â†“
                                      æ£€æŸ¥ IP ç™½åå•
  â†“                                    â†“
æ˜æ–‡ä¼ è¾“ rsync åè®® â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å†™å…¥æ¨¡å—è·¯å¾„
```

#### 0.4.7 ç‰¹ç‚¹æ€»ç»“

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **è®¤è¯æ–¹å¼** | ç”¨æˆ·å+å¯†ç ï¼ˆrsyncd.secretsï¼‰ |
| **åŠ å¯†** | âŒ æ˜æ–‡ä¼ è¾“ï¼ˆå¯ç”¨ stunnel åŠ å¯†ï¼‰ |
| **ç«¯å£** | 873ï¼ˆrsync daemon é»˜è®¤ç«¯å£ï¼‰ |
| **æ€§èƒ½** | é«˜ï¼ˆæ— åŠ å¯†å¼€é”€ï¼‰ |
| **å®‰å…¨æ€§** | ä½ï¼ˆä»…é€‚åˆå†…ç½‘ï¼‰ |
| **é…ç½®** | éœ€è¦é…ç½® rsyncd.conf å’Œ secrets |
| **æ¨¡å—åŒ–** | âœ… æ”¯æŒå¤šä¸ªå…±äº«æ¨¡å— |
| **é€‚ç”¨åœºæ™¯** | å†…ç½‘ã€å±€åŸŸç½‘ã€é«˜æ€§èƒ½éœ€æ±‚ |

---

### 0.5 ä¸‰ç§æ¨¡å¼å¯¹æ¯”æ€»ç»“

#### 0.5.1 å‘½ä»¤æ ¼å¼å¯¹æ¯”

```bash
# æœ¬åœ°æ¨¡å¼ï¼ˆæ— å†’å·ï¼‰
rsync -av /source/ /dest/

# SSH æ¨¡å¼ï¼ˆå•å†’å· :ï¼‰
rsync -avz /source/ user@host:/dest/
rsync -avz user@host:/source/ /dest/

# Daemon æ¨¡å¼ï¼ˆåŒå†’å· :: æˆ– rsync://ï¼‰
rsync -avz /source/ rsync://user@host/module/      # URL æ ¼å¼ï¼ˆæ¨èï¼‰
rsync -avz /source/ user@host::module/             # åŒå†’å·æ ¼å¼
rsync -avz rsync://user@host/module/ /dest/        # ä» daemon æ‹‰å–
```

#### 0.5.2 å¿«é€Ÿè¯†åˆ«è¡¨

| æ ¼å¼ | æ¨¡å¼ | ç¤ºä¾‹ |
|------|------|------|
| `/path/to/dest` | æœ¬åœ° | `rsync -av /src/ /dst/` |
| `user@host:/path` | SSH | `rsync -av /src/ user@host:/dst/` |
| `rsync://user@host/module` | Daemon (URL) | `rsync -av /src/ rsync://user@host/mod/` |
| `user@host::module` | Daemon (åŒå†’å·) | `rsync -av /src/ user@host::mod/` |

#### 0.5.3 ä½¿ç”¨å»ºè®®

**äº’è”ç½‘ç¯å¢ƒ**ï¼š
```bash
# âœ… ä½¿ç”¨ SSH æ¨¡å¼ï¼ˆåŠ å¯†å®‰å…¨ï¼‰
rsync -avz -e ssh /source/ user@remote.com:/backup/
```

**å†…ç½‘ç¯å¢ƒï¼ˆé«˜æ€§èƒ½éœ€æ±‚ï¼‰**ï¼š
```bash
# âœ… ä½¿ç”¨ Daemon æ¨¡å¼ï¼ˆé«˜æ€§èƒ½ï¼‰
rsync -avz --password-file=/etc/rsync/rsync.pass \
    /source/ rsync://user@10.0.5.21/backup/
```

**æœ¬åœ°å¤‡ä»½**ï¼š
```bash
# âœ… ä½¿ç”¨æœ¬åœ°æ¨¡å¼
rsync -av /data/ /backup/
```

---

### 0.6 å¸¸è§é”™è¯¯ä¸è¯†åˆ«

#### é”™è¯¯ 1ï¼šSSH æ¨¡å¼è¯¯ç”¨åŒå†’å·

```bash
# âŒ é”™è¯¯ï¼šSSH æ¨¡å¼ä½¿ç”¨åŒå†’å·
rsync -av -e ssh /source/ user@host::dest/

# âœ… æ­£ç¡®ï¼šSSH æ¨¡å¼ä½¿ç”¨å•å†’å·
rsync -av -e ssh /source/ user@host:/dest/
```

#### é”™è¯¯ 2ï¼šDaemon æ¨¡å¼ä½¿ç”¨æ–‡ä»¶è·¯å¾„è€Œéæ¨¡å—

```bash
# âŒ é”™è¯¯ï¼šDaemon æ¨¡å¼ç›´æ¥ä½¿ç”¨è·¯å¾„
rsync -av /source/ rsync://user@host/data/backup/

# âœ… æ­£ç¡®ï¼šDaemon æ¨¡å¼ä½¿ç”¨æ¨¡å—å
rsync -av /source/ rsync://user@host/backup/
#                                    ^^^^^^
#                                    æ¨¡å—åï¼ˆåœ¨ rsyncd.conf ä¸­å®šä¹‰ï¼‰
```

#### é”™è¯¯ 3ï¼šå¿˜è®°æœ«å°¾æ–œæ 

```bash
# âš ï¸ æ³¨æ„ï¼šæœ«å°¾æ–œæ çš„åŒºåˆ«

# åŒæ­¥ç›®å½•å†…å®¹åˆ° /backup/ï¼ˆ/backup/file1.txtï¼‰
rsync -av /source/ /backup/

# åŒæ­¥æ•´ä¸ªç›®å½•åˆ° /backup/ï¼ˆ/backup/source/file1.txtï¼‰
rsync -av /source /backup/
```

---

### 0.7 å®è·µå»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨ URL æ ¼å¼**ï¼ˆ`rsync://`ï¼‰ï¼š
   - æ›´ç¬¦åˆç°ä»£ URI æ ‡å‡†
   - å¯è¯»æ€§æ›´å¥½
   - æ–¹ä¾¿æŒ‡å®šç«¯å£

2. **ç”Ÿäº§ç¯å¢ƒå¯†ç æ–‡ä»¶**ï¼š
   ```bash
   # åˆ›å»ºå¯†ç æ–‡ä»¶
   echo "password123" > /etc/rsync/.rsync-pass
   chmod 600 /etc/rsync/.rsync-pass

   # åœ¨è„šæœ¬ä¸­ä½¿ç”¨
   rsync -avz --password-file=/etc/rsync/.rsync-pass \
       /source/ rsync://user@host/module/
   ```

3. **æµ‹è¯•è¿æ¥**ï¼š
   ```bash
   # SSH æ¨¡å¼æµ‹è¯•
   ssh user@host "echo 'SSH è¿æ¥æˆåŠŸ'"

   # Daemon æ¨¡å¼æµ‹è¯•ï¼ˆåˆ—å‡ºæ¨¡å—ï¼‰
   rsync rsync://host/

   # Daemon æ¨¡å¼æµ‹è¯•ï¼ˆåˆ—å‡ºæ–‡ä»¶ï¼‰
   rsync rsync://user@host/module/
   ```

4. **æŸ¥çœ‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯**ï¼š
   ```bash
   # SSH æ¨¡å¼è°ƒè¯•
   rsync -avvv -e ssh /source/ user@host:/dest/

   # Daemon æ¨¡å¼è°ƒè¯•
   rsync -avvv rsync://user@host/module/ /dest/
   ```

---

### 0.8 å‚è€ƒé¡¹ç›®

æœ¬ç›®å½•ä¸‹çš„å®è·µé¡¹ç›®ï¼š

| é¡¹ç›® | æ¨¡å¼ | ç›®å½• |
|------|------|------|
| **SSH æ‰‹å·¥é…ç½®** | SSH | `01.manual-rsync_inotify/` |
| **SSH è‡ªåŠ¨åŒ–** | SSH | `02.auto-rsync_inotify/` |
| **Daemon æ‰‹å·¥é…ç½®** | Daemon | `03.manual-rsync-service/` |
| **Daemon è‡ªåŠ¨åŒ–** | Daemon | `04.auto-rsync-service/` |
| **æ–¹æ³•å¯¹æ¯”æ€»ç»“** | å…¨éƒ¨ | `RSYNC_METHODS_COMPARISON.md` |

---

## 1. åŸºç¡€ä¼ è¾“é€‰é¡¹

### 1.1 å½’æ¡£æ¨¡å¼

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-a, --archive` | å½’æ¡£æ¨¡å¼ = `-rlptgoD` | **æœ€å¸¸ç”¨**ï¼Œå®Œæ•´å¤‡ä»½æ—¶ä½¿ç”¨ |
| `-r, --recursive` | é€’å½’å¤åˆ¶ç›®å½• | ä»…éœ€é€’å½’ï¼Œä¸éœ€ä¿ç•™å±æ€§ |
| `-d, --dirs` | ä¼ è¾“ç›®å½•ä½†ä¸é€’å½’ | åªåŒæ­¥ç›®å½•ç»“æ„ |

**ç¤ºä¾‹**ï¼š
```bash
# å®Œæ•´å½’æ¡£å¤‡ä»½
rsync -a /source/ /dest/

# ä»…é€’å½’å¤åˆ¶ï¼Œä¸ä¿ç•™å±æ€§
rsync -r /source/ /dest/
```

### 1.2 è¾“å‡ºæ§åˆ¶

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-v, --verbose` | æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ | è°ƒè¯•ã€æŸ¥çœ‹ä¼ è¾“è¿‡ç¨‹ |
| `-q, --quiet` | é™é»˜æ¨¡å¼ï¼Œä»…æ˜¾ç¤ºé”™è¯¯ | è„šæœ¬ä¸­ä½¿ç”¨ |
| `--progress` | æ˜¾ç¤ºä¼ è¾“è¿›åº¦ | äº¤äº’å¼æŸ¥çœ‹è¿›åº¦ |
| `-P` | = `--partial --progress` | **æ¨è**ï¼Œæ–­ç‚¹ç»­ä¼ +è¿›åº¦ |
| `-i, --itemize-changes` | æ˜¾ç¤ºæ–‡ä»¶å˜åŒ–æ‘˜è¦ | è¯¦ç»†äº†è§£æ¯ä¸ªæ–‡ä»¶çš„å˜åŒ– |
| `--stats` | æ˜¾ç¤ºä¼ è¾“ç»Ÿè®¡ä¿¡æ¯ | åˆ†æä¼ è¾“æ€§èƒ½ |

**ç¤ºä¾‹**ï¼š
```bash
# æ˜¾ç¤ºè¯¦ç»†è¿›åº¦
rsync -avP /source/ /dest/

# é™é»˜æ¨¡å¼ï¼ˆè„šæœ¬ï¼‰
rsync -aq /source/ /dest/

# è¯¦ç»†å˜åŒ–æ‘˜è¦
rsync -avi /source/ /dest/
```

### 1.3 æµ‹è¯•ä¸éªŒè¯

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-n, --dry-run` | æ¨¡æ‹Ÿè¿è¡Œï¼Œä¸å®é™…æ“ä½œ | **é‡è¦**ï¼Œæµ‹è¯•åŒæ­¥ç»“æœ |
| `-c, --checksum` | åŸºäºæ ¡éªŒå’Œè€Œéæ—¶é—´æˆ³ | ç¡®ä¿æ–‡ä»¶å®Œå…¨ä¸€è‡´ |
| `--list-only` | ä»…åˆ—å‡ºæ–‡ä»¶ï¼Œä¸å¤åˆ¶ | æŸ¥çœ‹æºç«¯æ–‡ä»¶åˆ—è¡¨ |

**ç¤ºä¾‹**ï¼š
```bash
# æµ‹è¯•ä¼šåŒæ­¥ä»€ä¹ˆæ–‡ä»¶
rsync -avz --dry-run /source/ /dest/

# åŸºäºæ ¡éªŒå’ŒéªŒè¯
rsync -avc /source/ /dest/
```

---

## 2. æ–‡ä»¶å±æ€§ä¿ç•™

### 2.1 æ—¶é—´æˆ³

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-t, --times` | ä¿ç•™ä¿®æ”¹æ—¶é—´ | **å¸¸ç”¨**ï¼Œå½’æ¡£åŒ…å«æ­¤é¡¹ |
| `-U, --atimes` | ä¿ç•™è®¿é—®æ—¶é—´ | éœ€è¦ç²¾ç¡®æ—¶é—´ä¿¡æ¯ |
| `-N, --crtimes` | ä¿ç•™åˆ›å»ºæ—¶é—´ | æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ—¶ |
| `-O, --omit-dir-times` | ä¸è®¾ç½®ç›®å½•æ—¶é—´ | ä»…åŒæ­¥æ–‡ä»¶æ—¶é—´ |
| `-J, --omit-link-times` | ä¸è®¾ç½®é“¾æ¥æ—¶é—´ | è·³è¿‡ç¬¦å·é“¾æ¥æ—¶é—´ |

**ç¤ºä¾‹**ï¼š
```bash
# ä¿ç•™æ‰€æœ‰æ—¶é—´å±æ€§
rsync -atUN /source/ /dest/
```

### 2.2 æƒé™ä¸æ‰€æœ‰æƒ

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-p, --perms` | ä¿ç•™æƒé™ | **å¸¸ç”¨**ï¼Œå½’æ¡£åŒ…å«æ­¤é¡¹ |
| `-o, --owner` | ä¿ç•™æ‰€æœ‰è€…ï¼ˆéœ€rootï¼‰ | ç³»ç»Ÿçº§å¤‡ä»½ |
| `-g, --group` | ä¿ç•™ç»„ | å¤šç”¨æˆ·ç¯å¢ƒ |
| `-E, --executability` | ä¿ç•™å¯æ‰§è¡Œå±æ€§ | ä»…éœ€ä¿ç•™æ‰§è¡Œæƒé™ |
| `--chmod=CHMOD` | ä¿®æ”¹æ–‡ä»¶æƒé™ | è°ƒæ•´æƒé™ |
| `--chown=USER:GROUP` | æ›´æ”¹æ‰€æœ‰è€… | ç»Ÿä¸€æ‰€æœ‰æƒ |

**ç¤ºä¾‹**ï¼š
```bash
# å®Œæ•´æƒé™å¤‡ä»½ï¼ˆéœ€rootï¼‰
rsync -avog /source/ /dest/

# è°ƒæ•´æƒé™
rsync -av --chmod=D755,F644 /source/ /dest/
```

### 2.3 é“¾æ¥ä¸è®¾å¤‡

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-l, --links` | ä¿ç•™ç¬¦å·é“¾æ¥ | **å¸¸ç”¨**ï¼Œå½’æ¡£åŒ…å«æ­¤é¡¹ |
| `-L, --copy-links` | å°†ç¬¦å·é“¾æ¥è½¬æ¢ä¸ºå®é™…æ–‡ä»¶ | è§£é™¤é“¾æ¥ä¾èµ– |
| `-H, --hard-links` | ä¿ç•™ç¡¬é“¾æ¥ | èŠ‚çœç©ºé—´ |
| `-K, --keep-dirlinks` | ä¿ç•™ç›®å½•ç¬¦å·é“¾æ¥ | ç‰¹æ®Šç›®å½•ç»“æ„ |
| `--devices` | ä¿ç•™è®¾å¤‡æ–‡ä»¶ï¼ˆéœ€rootï¼‰ | ç³»ç»Ÿå¤‡ä»½ |
| `--specials` | ä¿ç•™ç‰¹æ®Šæ–‡ä»¶ | å®Œæ•´ç³»ç»Ÿå¤‡ä»½ |
| `-D` | = `--devices --specials` | ç³»ç»Ÿçº§å¤‡ä»½ |

**ç¤ºä¾‹**ï¼š
```bash
# ä¿ç•™ç¡¬é“¾æ¥
rsync -avH /source/ /dest/

# è½¬æ¢ç¬¦å·é“¾æ¥ä¸ºæ–‡ä»¶
rsync -avL /source/ /dest/
```

### 2.4 æ‰©å±•å±æ€§

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-A, --acls` | ä¿ç•™ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ | Linuxæƒé™ç®¡ç† |
| `-X, --xattrs` | ä¿ç•™æ‰©å±•å±æ€§ | SELinuxã€æ–‡ä»¶æ ‡ç­¾ |
| `--fake-super` | ä½¿ç”¨xattrå­˜å‚¨ç‰¹æƒå±æ€§ | érootå¤‡ä»½ |

**ç¤ºä¾‹**ï¼š
```bash
# å®Œæ•´å±æ€§å¤‡ä»½
rsync -avAX /source/ /dest/

# érootæ¨¡æ‹Ÿsuperæƒé™
rsync -av --fake-super /source/ /dest/
```

---

## 3. æ–‡ä»¶è¿‡æ»¤ä¸æ’é™¤

### 3.1 æ’é™¤æ¨¡å¼

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--exclude=PATTERN` | æ’é™¤åŒ¹é…çš„æ–‡ä»¶ | **å¸¸ç”¨**ï¼Œæ’é™¤ç‰¹å®šæ–‡ä»¶ |
| `--exclude-from=FILE` | ä»æ–‡ä»¶è¯»å–æ’é™¤è§„åˆ™ | å¤æ‚æ’é™¤è§„åˆ™ |
| `--include=PATTERN` | åŒ…å«åŒ¹é…çš„æ–‡ä»¶ | ä¸excludeé…åˆä½¿ç”¨ |
| `--include-from=FILE` | ä»æ–‡ä»¶è¯»å–åŒ…å«è§„åˆ™ | å¤æ‚åŒ…å«è§„åˆ™ |
| `-C, --cvs-exclude` | CVSé£æ ¼æ’é™¤ | æ’é™¤.gitã€.svnç­‰ |

**ç¤ºä¾‹**ï¼š
```bash
# æ’é™¤æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶
rsync -av --exclude='*.log' --exclude='tmp/' /source/ /dest/

# ä½¿ç”¨æ’é™¤æ–‡ä»¶
rsync -av --exclude-from=/path/exclude.txt /source/ /dest/

# ä»…åŒæ­¥ç‰¹å®šæ–‡ä»¶ç±»å‹
rsync -av --include='*.txt' --exclude='*' /source/ /dest/
```

### 3.2 è¿‡æ»¤å™¨

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-f, --filter=RULE` | æ·»åŠ è¿‡æ»¤è§„åˆ™ | é«˜çº§è¿‡æ»¤ |
| `-F` | = `--filter='dir-merge /.rsync-filter'` | æ¯ç›®å½•è¿‡æ»¤è§„åˆ™ |
| `--files-from=FILE` | ä»æ–‡ä»¶è¯»å–æºæ–‡ä»¶åˆ—è¡¨ | ç²¾ç¡®æ§åˆ¶åŒæ­¥æ–‡ä»¶ |

**ç¤ºä¾‹**ï¼š
```bash
# é«˜çº§è¿‡æ»¤
rsync -av -f '- *.log' -f '+ *.txt' /source/ /dest/

# ä»æ–‡ä»¶åˆ—è¡¨åŒæ­¥
rsync -av --files-from=filelist.txt /source/ /dest/
```

### 3.3 å¤§å°é™åˆ¶

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--max-size=SIZE` | ä¸ä¼ è¾“å¤§äºSIZEçš„æ–‡ä»¶ | æ’é™¤å¤§æ–‡ä»¶ |
| `--min-size=SIZE` | ä¸ä¼ è¾“å°äºSIZEçš„æ–‡ä»¶ | æ’é™¤å°æ–‡ä»¶ |
| `--max-delete=NUM` | æœ€å¤šåˆ é™¤NUMä¸ªæ–‡ä»¶ | é˜²æ­¢è¯¯åˆ  |

**ç¤ºä¾‹**ï¼š
```bash
# ä»…åŒæ­¥å°äº100Mçš„æ–‡ä»¶
rsync -av --max-size=100M /source/ /dest/

# é˜²æ­¢å¤§é‡åˆ é™¤
rsync -av --delete --max-delete=10 /source/ /dest/
```

---

## 4. åŒæ­¥ç­–ç•¥

### 4.1 åˆ é™¤ç­–ç•¥

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--delete` | åˆ é™¤ç›®æ ‡å¤šä½™æ–‡ä»¶ | **é•œåƒåŒæ­¥** |
| `--delete-before` | ä¼ è¾“å‰åˆ é™¤ | èŠ‚çœç©ºé—´ |
| `--delete-during` | ä¼ è¾“ä¸­åˆ é™¤ | é»˜è®¤æ–¹å¼ |
| `--delete-after` | ä¼ è¾“ååˆ é™¤ | æ›´å®‰å…¨ |
| `--delete-delay` | å»¶è¿Ÿåˆ é™¤ | å¤§é‡æ–‡ä»¶æ—¶ |
| `--delete-excluded` | åˆ é™¤æ’é™¤çš„æ–‡ä»¶ | æ¸…ç†æ’é™¤æ–‡ä»¶ |
| `--ignore-errors` | æœ‰é”™è¯¯æ—¶ä»åˆ é™¤ | å¼ºåˆ¶åŒæ­¥ |
| `--force` | å¼ºåˆ¶åˆ é™¤éç©ºç›®å½• | æ¸…ç†ç›®å½• |

**ç¤ºä¾‹**ï¼š
```bash
# æ ‡å‡†é•œåƒåŒæ­¥
rsync -av --delete /source/ /dest/

# æ›´å®‰å…¨çš„åˆ é™¤
rsync -av --delete-after /source/ /dest/

# åˆ é™¤æ’é™¤çš„æ–‡ä»¶
rsync -av --delete --delete-excluded --exclude='*.log' /source/ /dest/
```

### 4.2 æ›´æ–°ç­–ç•¥

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-u, --update` | è·³è¿‡ç›®æ ‡ç«¯è¾ƒæ–°çš„æ–‡ä»¶ | åŒå‘åŒæ­¥ä¿æŠ¤ |
| `--ignore-existing` | è·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶ | ä»…æ·»åŠ æ–°æ–‡ä»¶ |
| `--existing` | ä»…æ›´æ–°å·²å­˜åœ¨çš„æ–‡ä»¶ | ä¸åˆ›å»ºæ–°æ–‡ä»¶ |
| `--size-only` | ä»…åŸºäºå¤§å°åˆ¤æ–­ | å¿«é€ŸåŒæ­¥ |
| `--ignore-times, -I` | ä¸è·³è¿‡ç›¸åŒå¤§å°å’Œæ—¶é—´ | å¼ºåˆ¶æ£€æŸ¥ |
| `--modify-window=NUM` | æ—¶é—´æˆ³å®¹å·®ï¼ˆç§’ï¼‰ | è·¨å¹³å°åŒæ­¥ |

**ç¤ºä¾‹**ï¼š
```bash
# ä¸è¦†ç›–æ–°æ–‡ä»¶
rsync -avu /source/ /dest/

# ä»…æ›´æ–°å·²å­˜åœ¨æ–‡ä»¶
rsync -av --existing /source/ /dest/

# Windows-LinuxåŒæ­¥ï¼ˆæ—¶é—´ç²¾åº¦ï¼‰
rsync -av --modify-window=1 /source/ /dest/
```

### 4.3 å¤‡ä»½ç­–ç•¥

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-b, --backup` | å¤‡ä»½è¢«æ›¿æ¢çš„æ–‡ä»¶ | ä¿ç•™æ—§ç‰ˆæœ¬ |
| `--backup-dir=DIR` | å¤‡ä»½æ–‡ä»¶å­˜æ”¾ç›®å½• | é›†ä¸­ç®¡ç†å¤‡ä»½ |
| `--suffix=SUFFIX` | å¤‡ä»½æ–‡ä»¶åç¼€ | è‡ªå®šä¹‰å¤‡ä»½æ ‡è¯† |

**ç¤ºä¾‹**ï¼š
```bash
# å¤‡ä»½åˆ°æŒ‡å®šç›®å½•
rsync -av --backup --backup-dir=/backup/old /source/ /dest/

# è‡ªå®šä¹‰å¤‡ä»½åç¼€
rsync -av --backup --suffix=.bak /source/ /dest/
```

---

## 5. æ€§èƒ½ä¼˜åŒ–

### 5.1 ä¼ è¾“ä¼˜åŒ–

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-z, --compress` | å‹ç¼©ä¼ è¾“æ•°æ® | **ç½‘ç»œä¼ è¾“** |
| `--compress-choice=STR` | é€‰æ‹©å‹ç¼©ç®—æ³•ï¼ˆzstd/lz4/zlibï¼‰ | æ€§èƒ½è°ƒä¼˜ |
| `--compress-level=NUM` | å‹ç¼©çº§åˆ«ï¼ˆ0-9ï¼‰ | å¹³è¡¡é€Ÿåº¦å’Œå‹ç¼©ç‡ |
| `--skip-compress=LIST` | è·³è¿‡å·²å‹ç¼©æ–‡ä»¶ | é¿å…é‡å¤å‹ç¼© |
| `-W, --whole-file` | ä¸ä½¿ç”¨å¢é‡ç®—æ³• | æœ¬åœ°å¿«é€Ÿå¤åˆ¶ |
| `--inplace` | å°±åœ°æ›´æ–°æ–‡ä»¶ | èŠ‚çœç©ºé—´ |
| `--append` | é™„åŠ æ•°æ®åˆ°çŸ­æ–‡ä»¶ | æ–­ç‚¹ç»­ä¼  |
| `--append-verify` | é™„åŠ +æ ¡éªŒ | æ›´å®‰å…¨çš„ç»­ä¼  |

**ç¤ºä¾‹**ï¼š
```bash
# ç½‘ç»œä¼ è¾“å‹ç¼©
rsync -avz /source/ remote:/dest/

# ä½¿ç”¨zstdé«˜æ€§èƒ½å‹ç¼©
rsync -av --compress-choice=zstd /source/ remote:/dest/

# æœ¬åœ°å¿«é€Ÿå¤åˆ¶
rsync -av --whole-file /source/ /dest/

# å°±åœ°æ›´æ–°å¤§æ–‡ä»¶
rsync -av --inplace /source/ /dest/
```

### 5.2 å¹¶å‘ä¸é™åˆ¶

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--bwlimit=RATE` | é™åˆ¶å¸¦å®½ï¼ˆKB/sï¼‰ | é¿å…å æ»¡å¸¦å®½ |
| `--timeout=SECONDS` | I/Oè¶…æ—¶æ—¶é—´ | ç½‘ç»œä¸ç¨³å®šæ—¶ |
| `--contimeout=SECONDS` | è¿æ¥è¶…æ—¶æ—¶é—´ | daemonæ¨¡å¼ |
| `--max-alloc=SIZE` | å†…å­˜åˆ†é…é™åˆ¶ | èµ„æºå—é™ç¯å¢ƒ |

**ç¤ºä¾‹**ï¼š
```bash
# é™é€Ÿ1MB/s
rsync -av --bwlimit=1024 /source/ /dest/

# è®¾ç½®è¶…æ—¶
rsync -av --timeout=300 /source/ remote:/dest/
```

### 5.3 ä¼˜åŒ–é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-S, --sparse` | ç¨€ç–æ–‡ä»¶ä¼˜åŒ– | è™šæ‹Ÿæœºé•œåƒ |
| `--preallocate` | é¢„åˆ†é…ç›®æ ‡æ–‡ä»¶ | å‡å°‘ç¢ç‰‡ |
| `--partial` | ä¿ç•™éƒ¨åˆ†ä¼ è¾“æ–‡ä»¶ | æ–­ç‚¹ç»­ä¼  |
| `--partial-dir=DIR` | éƒ¨åˆ†æ–‡ä»¶å­˜æ”¾ç›®å½• | é›†ä¸­ç®¡ç†ä¸´æ—¶æ–‡ä»¶ |
| `--delay-updates` | ä¼ è¾“å®Œæˆåæ›´æ–° | åŸå­æ€§æ›´æ–° |
| `-m, --prune-empty-dirs` | åˆ é™¤ç©ºç›®å½•é“¾ | æ¸…ç†ç›®å½•æ ‘ |

**ç¤ºä¾‹**ï¼š
```bash
# ç¨€ç–æ–‡ä»¶ä¼˜åŒ–
rsync -avS /vms/ /backup/vms/

# æ–­ç‚¹ç»­ä¼ 
rsync -avP --partial-dir=/tmp/rsync-partial /source/ /dest/
```

---

## 6. ç½‘ç»œä¸è¿æ¥

### 6.1 è¿œç¨‹Shell

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-e, --rsh=COMMAND` | æŒ‡å®šè¿œç¨‹shell | **SSHä¼ è¾“** |
| `--rsync-path=PROGRAM` | æŒ‡å®šè¿œç¨‹rsyncè·¯å¾„ | éæ ‡å‡†è·¯å¾„ |
| `--blocking-io` | ä½¿ç”¨é˜»å¡I/O | è¿œç¨‹shellå…¼å®¹ |
| `--protect-args, -s` | ä¿æŠ¤å‚æ•°ä¸å±•å¼€ | ç‰¹æ®Šå­—ç¬¦å¤„ç† |

**ç¤ºä¾‹**ï¼š
```bash
# ä½¿ç”¨SSHä¼ è¾“
rsync -av -e "ssh -p 2222" /source/ user@remote:/dest/

# SSHé€‰é¡¹
rsync -av -e "ssh -o StrictHostKeyChecking=no" /source/ remote:/dest/

# æŒ‡å®šè¿œç¨‹rsyncè·¯å¾„
rsync -av --rsync-path=/usr/local/bin/rsync /source/ remote:/dest/
```

### 6.2 Daemonæ¨¡å¼

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--port=PORT` | æŒ‡å®šç«¯å£ | éæ ‡å‡†ç«¯å£ |
| `--password-file=FILE` | å¯†ç æ–‡ä»¶ | è‡ªåŠ¨åŒ–è®¤è¯ |
| `--address=ADDRESS` | ç»‘å®šåœ°å€ | å¤šIPæœåŠ¡å™¨ |
| `--sockopts=OPTIONS` | TCPé€‰é¡¹ | ç½‘ç»œè°ƒä¼˜ |
| `--no-motd` | ä¸æ˜¾ç¤ºMOTD | è„šæœ¬ä½¿ç”¨ |

**ç¤ºä¾‹**ï¼š
```bash
# Daemonæ¨¡å¼ä¼ è¾“
rsync -av rsync://user@server/module/ /dest/

# ä½¿ç”¨å¯†ç æ–‡ä»¶
rsync -av --password-file=/root/.rsync-pass rsync://server/module/ /dest/
```

### 6.3 åè®®ç‰ˆæœ¬

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--protocol=NUM` | å¼ºåˆ¶ä½¿ç”¨æ—§åè®® | å…¼å®¹æ€§ |
| `-4, --ipv4` | ä½¿ç”¨IPv4 | å¼ºåˆ¶IPv4 |
| `-6, --ipv6` | ä½¿ç”¨IPv6 | å¼ºåˆ¶IPv6 |

**ç¤ºä¾‹**ï¼š
```bash
# å…¼å®¹æ—§ç‰ˆrsync
rsync -av --protocol=29 /source/ old-server:/dest/
```

---

## 7. å®‰å…¨ä¸æƒé™

### 7.1 æƒé™æ§åˆ¶

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--super` | å°è¯•è¶…çº§ç”¨æˆ·æ“ä½œ | rootæƒé™å¤‡ä»½ |
| `--fake-super` | ä½¿ç”¨xattræ¨¡æ‹Ÿæƒé™ | **érootå¤‡ä»½** |
| `--numeric-ids` | ä¸æ˜ å°„UID/GID | è·¨ç³»ç»Ÿå¤‡ä»½ |
| `--usermap=STRING` | ç”¨æˆ·åæ˜ å°„ | ç”¨æˆ·åä¸åŒ |
| `--groupmap=STRING` | ç»„åæ˜ å°„ | ç»„åä¸åŒ |
| `--copy-as=USER[:GROUP]` | ä»¥æŒ‡å®šç”¨æˆ·èº«ä»½å¤åˆ¶ | æƒé™æ§åˆ¶ |

**ç¤ºä¾‹**ï¼š
```bash
# érootå®Œæ•´å¤‡ä»½
rsync -av --fake-super /source/ /dest/

# ç”¨æˆ·æ˜ å°„
rsync -av --usermap=olduser:newuser /source/ /dest/
```

### 7.2 æ–‡ä»¶ç³»ç»Ÿ

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-x, --one-file-system` | ä¸è·¨æ–‡ä»¶ç³»ç»Ÿ | é¿å…æŒ‚è½½ç‚¹ |
| `--iconv=CONVERT_SPEC` | å­—ç¬¦é›†è½¬æ¢ | è·¨å¹³å° |

**ç¤ºä¾‹**ï¼š
```bash
# ä¸è·¨è¶ŠæŒ‚è½½ç‚¹
rsync -avx / /backup/

# å­—ç¬¦é›†è½¬æ¢
rsync -av --iconv=UTF-8,GBK /source/ /dest/
```

---

## 8. æ—¥å¿—ä¸ç›‘æ§

### 8.1 è¾“å‡ºæ ¼å¼

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--out-format=FORMAT` | è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ | æ—¥å¿—åˆ†æ |
| `-h, --human-readable` | äººç±»å¯è¯»æ ¼å¼ | äº¤äº’ä½¿ç”¨ |
| `-8, --8-bit-output` | 8ä½å­—ç¬¦è¾“å‡º | éASCIIæ–‡ä»¶å |
| `--outbuf=N\|L\|B` | è¾“å‡ºç¼“å†²ï¼ˆæ— \|è¡Œ\|å—ï¼‰ | æ—¥å¿—æ§åˆ¶ |

**ç¤ºä¾‹**ï¼š
```bash
# äººç±»å¯è¯»
rsync -avh /source/ /dest/

# è‡ªå®šä¹‰è¾“å‡º
rsync -av --out-format='%t %f %b' /source/ /dest/
```

### 8.2 æ—¥å¿—æ–‡ä»¶

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--log-file=FILE` | è®°å½•åˆ°æ–‡ä»¶ | å®¡è®¡è¿½è¸ª |
| `--log-file-format=FMT` | æ—¥å¿—æ ¼å¼ | è‡ªå®šä¹‰æ—¥å¿— |
| `--info=FLAGS` | ç²¾ç»†ä¿¡æ¯çº§åˆ« | è¯¦ç»†è°ƒè¯• |
| `--debug=FLAGS` | è°ƒè¯•ä¿¡æ¯ | æ•…éšœæ’æŸ¥ |

**ç¤ºä¾‹**ï¼š
```bash
# è®°å½•æ—¥å¿—
rsync -av --log-file=/var/log/rsync.log /source/ /dest/

# è°ƒè¯•ä¿¡æ¯
rsync -av --debug=ALL /source/ /dest/
```

---

## 9. é«˜çº§åŠŸèƒ½

### 9.1 æ‰¹å¤„ç†

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--write-batch=FILE` | å†™å…¥æ‰¹å¤„ç†æ–‡ä»¶ | ç¦»çº¿ä¼ è¾“ |
| `--only-write-batch=FILE` | ä»…å†™æ‰¹å¤„ç† | ä¸æ›´æ–°ç›®æ ‡ |
| `--read-batch=FILE` | è¯»å–æ‰¹å¤„ç†æ–‡ä»¶ | åº”ç”¨æ‰¹å¤„ç† |

**ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºæ‰¹å¤„ç†
rsync -av --write-batch=/tmp/batch /source/ /dest/

# åº”ç”¨æ‰¹å¤„ç†
rsync -av --read-batch=/tmp/batch /dest/
```

### 9.2 ç›¸ä¼¼æ–‡ä»¶

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `-y, --fuzzy` | æŸ¥æ‰¾ç›¸ä¼¼æ–‡ä»¶ | é‡å‘½åæ£€æµ‹ |
| `--compare-dest=DIR` | æ¯”è¾ƒç›®å½• | å¢é‡å¤‡ä»½ |
| `--copy-dest=DIR` | å¤åˆ¶æœªå˜åŒ–æ–‡ä»¶ | å¿«é€Ÿå¤‡ä»½ |
| `--link-dest=DIR` | ç¡¬é“¾æ¥æœªå˜åŒ–æ–‡ä»¶ | **å¢é‡å¤‡ä»½** |

**ç¤ºä¾‹**ï¼š
```bash
# ç¡¬é“¾æ¥å¢é‡å¤‡ä»½
rsync -av --link-dest=/backup/yesterday /source/ /backup/today/

# æ¨¡ç³ŠåŒ¹é…
rsync -avy /source/ /dest/
```

### 9.3 å…¶ä»–é«˜çº§é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--checksum-seed=NUM` | æ ¡éªŒå’Œç§å­ | é«˜çº§è°ƒè¯• |
| `--temp-dir=DIR, -T` | ä¸´æ—¶æ–‡ä»¶ç›®å½• | è‡ªå®šä¹‰ä¸´æ—¶ä½ç½® |
| `--fsync` | æ¯ä¸ªæ–‡ä»¶fsync | ç¡®ä¿å†™å…¥ç£ç›˜ |
| `--remove-source-files` | åˆ é™¤æºæ–‡ä»¶ | ç§»åŠ¨è€Œéå¤åˆ¶ |

**ç¤ºä¾‹**ï¼š
```bash
# ç§»åŠ¨æ–‡ä»¶
rsync -av --remove-source-files /source/ /dest/

# ç¡®ä¿åŒæ­¥åˆ°ç£ç›˜
rsync -av --fsync /source/ /dest/
```

---

## 10. å¸¸ç”¨åœºæ™¯ç»„åˆ

### 10.1 æœ¬åœ°å®Œæ•´å¤‡ä»½

```bash
# åœºæ™¯ï¼šå®Œæ•´ç³»ç»Ÿå¤‡ä»½
rsync -aAXv --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found"} / /backup/

# è¯´æ˜ï¼š
# -a: å½’æ¡£æ¨¡å¼
# -A: ä¿ç•™ACL
# -X: ä¿ç•™æ‰©å±•å±æ€§
# -v: è¯¦ç»†è¾“å‡º
# --exclude: æ’é™¤ç³»ç»Ÿç›®å½•
```

### 10.2 è¿œç¨‹å¢é‡å¤‡ä»½

```bash
# åœºæ™¯ï¼šSSHè¿œç¨‹å¢é‡å¤‡ä»½
rsync -avz --delete -e "ssh -p 22" /source/ user@remote:/backup/

# è¯´æ˜ï¼š
# -z: å‹ç¼©ä¼ è¾“
# --delete: é•œåƒåŒæ­¥
# -e ssh: ä½¿ç”¨SSH
```

### 10.3 å¤§æ–‡ä»¶åŒæ­¥

```bash
# åœºæ™¯ï¼šå¤§æ–‡ä»¶ä¼ è¾“ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰
rsync -avP --inplace --partial-dir=/tmp/rsync /large-files/ /dest/

# è¯´æ˜ï¼š
# -P: è¿›åº¦+éƒ¨åˆ†ä¼ è¾“
# --inplace: å°±åœ°æ›´æ–°
# --partial-dir: ä¸´æ—¶æ–‡ä»¶ç›®å½•
```

### 10.4 é•œåƒç½‘ç«™

```bash
# åœºæ™¯ï¼šç½‘ç«™å®Œæ•´é•œåƒ
rsync -avz --delete --exclude='*.log' --exclude='cache/*' /var/www/ remote:/var/www/

# è¯´æ˜ï¼š
# --delete: åˆ é™¤å¤šä½™æ–‡ä»¶
# --exclude: æ’é™¤æ—¥å¿—å’Œç¼“å­˜
```

### 10.5 å®æ—¶åŒæ­¥è„šæœ¬é…åˆ

```bash
# åœºæ™¯ï¼šInotify + Rsync å®æ—¶åŒæ­¥
rsync -avz --delete -e "ssh -o StrictHostKeyChecking=no" /data/source/ root@backup:/data/dest/

# è¯´æ˜ï¼š
# ç”¨äºinotifyè§¦å‘çš„åŒæ­¥
# -o StrictHostKeyChecking=no: è·³è¿‡SSHéªŒè¯
```

### 10.6 å¢é‡å¿«ç…§å¤‡ä»½

```bash
# åœºæ™¯ï¼šæ¯æ—¥å¢é‡å¿«ç…§ï¼ˆç¡¬é“¾æ¥ï¼‰
TODAY=$(date +%Y%m%d)
YESTERDAY=$(date -d "yesterday" +%Y%m%d)

rsync -av --delete --link-dest=/backup/$YESTERDAY /source/ /backup/$TODAY/

# è¯´æ˜ï¼š
# --link-dest: æœªå˜åŒ–æ–‡ä»¶ç¡¬é“¾æ¥åˆ°æ˜¨å¤©
# èŠ‚çœå¤§é‡ç©ºé—´
```

### 10.7 é™é€ŸåŒæ­¥

```bash
# åœºæ™¯ï¼šé™åˆ¶å¸¦å®½é¿å…å½±å“ä¸šåŠ¡
rsync -avz --bwlimit=5120 --timeout=300 /source/ remote:/dest/

# è¯´æ˜ï¼š
# --bwlimit=5120: é™é€Ÿ5MB/s
# --timeout=300: 5åˆ†é’Ÿè¶…æ—¶
```

### 10.8 ä»…åŒæ­¥ç‰¹å®šæ–‡ä»¶ç±»å‹

```bash
# åœºæ™¯ï¼šä»…åŒæ­¥å›¾ç‰‡æ–‡ä»¶
rsync -av --include='*.jpg' --include='*.png' --include='*/' --exclude='*' /photos/ /backup/

# è¯´æ˜ï¼š
# å¿…é¡»å…ˆincludeç›®å½•ï¼ˆ*/ï¼‰ï¼Œå†excludeå…¶ä»–
```

### 10.9 åŒå‘åŒæ­¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

```bash
# åœºæ™¯ï¼šåŒå‘åŒæ­¥ï¼ˆä½¿ç”¨updateé¿å…è¦†ç›–æ–°æ–‡ä»¶ï¼‰
rsync -avu /dir1/ /dir2/
rsync -avu /dir2/ /dir1/

# è­¦å‘Šï¼š
# è¿™ä¸æ˜¯çœŸæ­£çš„åŒå‘åŒæ­¥
# å»ºè®®ä½¿ç”¨unisonç­‰ä¸“ç”¨å·¥å…·
```

### 10.10 Dockerå®¹å™¨æ•°æ®å¤‡ä»½

```bash
# åœºæ™¯ï¼šDocker Volumeå¤‡ä»½
VOLUME_PATH=$(docker volume inspect volume_name --format '{{ .Mountpoint }}')
rsync -aAXv $VOLUME_PATH/ /backup/docker-volumes/volume_name/

# è¯´æ˜ï¼š
# ä¿ç•™å®Œæ•´æƒé™å’Œå±æ€§
```

---

## ğŸ“š å¸¸è§é—®é¢˜ä¸æŠ€å·§

### Q1: å¦‚ä½•æµ‹è¯•ä¸å®é™…æ‰§è¡Œï¼Ÿ
```bash
rsync -avz --dry-run /source/ /dest/
```

### Q2: å¦‚ä½•æ’é™¤å¤šä¸ªç›®å½•ï¼Ÿ
```bash
rsync -av --exclude={'dir1','dir2','*.log'} /source/ /dest/
```

### Q3: å¦‚ä½•é™åˆ¶ä¼ è¾“é€Ÿåº¦ï¼Ÿ
```bash
rsync -av --bwlimit=1024 /source/ /dest/  # 1MB/s
```

### Q4: å¦‚ä½•æ˜¾ç¤ºä¼ è¾“è¿›åº¦ï¼Ÿ
```bash
rsync -avP /source/ /dest/
# æˆ–
rsync -av --progress /source/ /dest/
```

### Q5: å¦‚ä½•ä¿ç•™åˆ é™¤çš„æ–‡ä»¶ï¼Ÿ
```bash
rsync -av --delete --backup --backup-dir=/backup/deleted /source/ /dest/
```

### Q6: æœ«å°¾çš„ / æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
```bash
/source/   # åŒæ­¥ç›®å½•å†…å®¹
/source    # åŒæ­¥ç›®å½•æœ¬èº«

# ç¤ºä¾‹ï¼š
rsync -av /data/source/ /backup/    # /backup/ä¸‹ç›´æ¥æ˜¯æ–‡ä»¶
rsync -av /data/source  /backup/    # /backup/source/ä¸‹æ˜¯æ–‡ä»¶
```

### Q7: å¦‚ä½•å¤„ç†ç‰¹æ®Šå­—ç¬¦æ–‡ä»¶åï¼Ÿ
```bash
rsync -av -s /source/ /dest/  # --protect-args
```

### Q8: å¦‚ä½•åŒæ­¥ç¨€ç–æ–‡ä»¶ï¼ˆè™šæ‹Ÿæœºé•œåƒï¼‰ï¼Ÿ
```bash
rsync -avS /vms/ /backup/vms/
```

---

## ğŸ”— å‚è€ƒèµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://rsync.samba.org/
- **Manæ‰‹å†Œ**: `man rsync`
- **ç‰ˆæœ¬æŸ¥çœ‹**: `rsync --version`
- **å®è·µé¡¹ç›®**: `/root/docker-man/05.realtime-sync/01.manual-rsync_inotify/`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-09
**ç»´æŠ¤è€…**: docker-man é¡¹ç›®ç»„
